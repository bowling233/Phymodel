# 用户手册和技术文档

## 一、界面简介和使用方法

首先，为保证程序正确运行，程序目录结构应该如下
* currentPath
  * program
    * fs_coord.glsl
    * ***.glsl
    * time.exe
    * event.exe
    * index.exe
    * gas.exe
    * exp1.exe
    * exp2.exe
    * exp3.exe
    * ...
  * data
    * exp1
      * 4.1.1.1.txt
      * 4.1.1.2.txt
      * ...
    * exp2
      * ...
    * exp3
      * ...
    * ball_8_210829.txt
    * gas_725430_223329.txt
    * ...
  * result
    * exp1.txt
    * exp2.txt
    * exp3.txt
    * result_gas_725430_223329.txt
    * ...
  * openGL.exe

### 1.数据生成和启动器

数据生成器使用Qt6.6编写，程序用选项卡分为6个部分，界面如下图所示


* 生成
    * 球体系统
        * 球体信息
        * 容器信息
        * 生成
    * 理想气体：默认设置好氧气分子的信息，关闭OpenGL，不输出数据，不显示帧率，显示系统信息
        * 容器边长(um)
        * 压强
        * 温度
        * 生成
* 实验
    * 选择并启动实验
* 启动
    * 当前选择数据文件
    * 选择算法
    * 控制
    * 启动


> 提醒：压强并不会影响理想气体的速率分布，仅影响气体分子的个数和间距。需要严密设计数据生成器。

### 2.模拟程序

模拟程序无需用户操作。模拟程序`main(int argc, char * argv[])`函数接收一个argv字符串作为参数，自动读取数据并运行。

## 二、技术文档

### 2.1 数据文件设计

数据文档分区设计如下：

* Line1:控制变量，0表示关闭，1表示开启
    * OpenGL可视化
    * 关闭窗口时输出数据到result.txt
    * 显示帧率
    * 显示系统信息
* Line2:相机数据
    * CameraLoc:相机位置
    * LookAt:视点位置
    * rot_v:环绕旋转角速度
    * dispRate:指定系统运动速度，系统运动时间为1/dispRate
* Line3-End:CollisionSystem系统信息
    * 读取至该部分时ifstrm文件输入流控制权转交至`CollisionSystem::init()`函数
    * 第一行用一个大写字母表示其类型，一个数字表示该物体的数量n
    * 重复执行n次该物体的输入函数，读取n个物体
    * 若没到文件尾，则重复操作

数据文档中，统一使用`\t`制表符分割数字、字母，便于excel识别。浮点数统一设置`std::setprecision(8) << std::fixed;`

输出文件不包括Line1-2。示例输入文件如下

```txt
1   1   1   1
5  5  5  0   0   0   0.05 60.0
C   1
0	0	0   4.5	4.5	4.5
B   8
-0.75	-0.75	-0.75	1.88076	2.03076	0.731008	1	0.5
-0.75	-0.75	0.75	0.280817	-2.02327	-0.129921	1	0.5
-0.75	0.75	-0.75	-0.413147	-0.65409	0.724323	1	0.5
-0.75	0.75	0.75	0.263846	0.997354	0.788994	1	0.5
0.75	-0.75	-0.75	2.44584	1.01916	-0.7603	1	0.5
0.75	-0.75	0.75	-0.16675	-1.75322	0.298298	1	0.5
0.75	0.75	-0.75	2.06121	0.261415	1.07991	1	0.5
0.75	0.75	0.75	0.444628	0.923812	0.181061	1	0.5
```

### 2.2 数据生成与启动器设计

#### 组件功能设计以及实现步骤

* 在组件中输入并不会立即改变程序内相关变量的值，仅按下按钮时从组件中读取对应值

##### 球体的生成

按下生成按钮后，程序执行如下步骤：

* 获得生成文件夹路径`genDir`
* 获得当前选项卡信息（球体or气体），获取生成参数
* 根据生成参数生成数据文件名称`genFileName`
  * 文件名称约定：`type_num_time.txt`
    * type: ball, gas
    * num: 系统球体个数
    * time：day+hour+minute+second
* 生成数据
* 生成完成，关闭文件，弹窗通知

球体速度的生成：
* 不勾选分布：使用GLM库生成定长为$v$的随机向量
* 勾选分布：把所填速度$v$视为标准差，每个速度分量服从正态分布$N(0, v)$

质量和半径：若勾选随机，将输入值视为最大值$max$，则服从均匀分布$U(0, max)$

##### 气体的生成

给定$p,V,T$，生成气体分子数据：

1. 通过理想气体状态方程确定容器内气体分子数$$N=\frac{pVN_A}{RT}$$其中$R=8.314462618 J mol^{-1} K^{-1}$是普适气体常量
2. 通过理想气体状态方程求得气体分子平均距离$$d=\sqrt[3]{\frac{RT}{pN_A}}$$
3. 求得每边分子数$$n=\left\lfloor \frac{\sqrt[3]{V}}{d}\right\rfloor$$
> 注意：最终生成分子数为$n^3$, 因此此处的向下取整可能导致分子数量大幅缩水。为此，采用这样的调适方法： 
> 若$n^3<N$（几乎都会这样：生成的分子数小于实际分子数。实测当容器边长为0.3时少了约2000个分子）：分别尝试对各边分子数加1，重新协调该方向的距离$gDis$， 直到$n_X n_Y n_Z > N $为止。在生成循环中添加测试条件，当生成个数到达$N$时停止。以此保证生成气体分子数保持准确。
3. 确定分子速度分量分布函数的方差$$\sigma^2=\frac{k_B T}{m}$$，具体数据生成方法同球体系统。
> 注意，STL正态分布随机数引擎第二个参数是标准差$\sigma$，与我们教材中$N(\mu,\sigma^2)$使用的方差不同
> 
> 数据来源:https://physics.nist.gov/cgi-bin/cuu/Value


## 三、应用程序接口
